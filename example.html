<html>
  <head>
    <title>Demo</title>
    <script src="../dist/d3-force-graph.js"></script>
    <style>
      .setting {
        display: flex;
        height: 50px;
        line-height: 50px;
        justify-content: space-around;
        background: #242424;
        color: #aaaaaa;
      }
      body {
        padding: 0;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <div class="setting">
      <div>
        <span>nodeNum </span>
        <select id="nodeNum">
          <option value="2" selected>2</option>
          <option value="10">10</option>
          <option value="100">100</option>
          <option value="500">500</option>
          <option value="1000">1000</option>
          <option value="5000">5000</option>
          <option value="10000">10000</option>
          <option value="50000">50000</option>
          <option value="100000">100000</option>
        </select>
      </div>

      <div>
        <span>linkNum </span>
        <span id="linkNum"></span>
      </div>
    </div>
    <div id="container"></div>
    <script>
      let graph = null;
      window.onload = () => {
        let $container = document.getElementById("container");
        let $nodeNum = document.getElementById("nodeNum");
        let $linkNum = document.getElementById("linkNum");
        let nodeType = ["APPLICATION", "POD", "PROCESS", "WORKLOAD", "NODE", "MIDDLEWARE"];
        let middleWareNodeType = ["cache", "database", "mq"];
        let lineType = ["createOn", "tracingTo"];
        changeNodeNum();
        $nodeNum.addEventListener("change", changeNodeNum);

        function changeNodeNum() {
          let testData = {
            nodes: [],
            links: [],
          };
          let nodeNum = parseInt($nodeNum.value);
          $linkNum.innerText = nodeNum / 2;

          for (let i = 0; i < nodeNum; i++) {
            let node = {
              id: "node" + i,
              type: nodeType[Math.floor(Math.random() * nodeType.length)],
              event: Math.floor(Math.random() * 30)
            }
            if(node.type === 'MIDDLEWARE')
              node.middleWareType = middleWareNodeType[Math.floor(Math.random() * middleWareNodeType.length)]
            testData.nodes.push(node);
          }

          for (let i = 0; i < nodeNum / 2; i++) {
            let line = {
              source: "node" + Math.floor(Math.random() * nodeNum),
              target: "node" + Math.floor(Math.random() * nodeNum),
              lineType: lineType[Math.floor(Math.random() * lineType.length)],
            };
            if (line.lineType === lineType[1]) {
              line.speed = Math.floor(Math.random() * 1000) + 1;
            }
            testData.links.push(line);
          }
          console.log(testData)
          if (graph) {
            graph.destroy();
          }
          graph = new D3ForceGraph($container, testData, {
            width: window.innerWidth,
            height: window.innerHeight - 50,
          });
        }
      };
    </script>
  </body>
</html>
